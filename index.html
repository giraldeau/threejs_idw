<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<div id="container"></div>

<script id="vertexShader" type="x-shader/x-vertex">
        void main() {
            gl_Position = vec4( position, 1.0 );
        }


</script>
<script id="fragmentShader" type="x-shader/x-fragment">

        #define NB_POINTS {{nb_points}}
        uniform vec2 u_resolution;
        uniform float u_time;
        uniform int u_nb_points;
        uniform vec3 u_points [ NB_POINTS ];
        uniform vec3 u_colors [ 3];

        // The Book of Shaders by Patricio Gonzalez Vivo & Jen Lowe
        vec3 rgb2hsb( in vec3 c ){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz),
                         vec4(c.gb, K.xy),
                         step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r),
                         vec4(c.r, p.yzx),
                         step(p.x, c.r));
            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)),
                        d / (q.x + e),
                        q.x);
        }

        float circle(in vec2 _st, in float _radius){
            vec2 dist = _st-vec2(0.5);
            return 1.-smoothstep(_radius-(_radius*0.01),
                _radius+(_radius*0.01),
                dot(dist,dist)*4.0);
        }

        float idw(in vec2 _st) {
             vec2 loc = vec2(0.3,0.3);
             vec2 loc2 = vec2(0.7, 0.7);
             vec3 pts;

             float prop = 0.0;
             float dist = 0.0;

             float weigthed_prop = 0.0;

             float weigthed_prop_sum = 0.0;
             float weigth_sum = 0.0;

             for (int i = 0; i < NB_POINTS; i++) {
                 pts = u_points[i];
                 loc = pts.xy;
                 prop = pts[2];

                 //prop = float(i) * 0.8 + 0.2;
                 dist = distance(_st, loc);
                 weigthed_prop_sum = weigthed_prop_sum + (prop / dist);
                 weigth_sum = weigth_sum + (1.0 / dist);
             }

             return (weigthed_prop_sum / weigth_sum);
        }

        vec3 prop2color(in float _prop) {

             return vec3(0.0, 0.0, _prop);
        }

        vec3 three_color_gradient(in float _value, in vec3 _rgb_a, in vec3 _rgb_b, in vec3 _rgb_c) {
           vec3 _hsb_a = rgb2hsb(_rgb_a);
           vec3 _hsb_b = rgb2hsb(_rgb_b);
           vec3 _hsb_c = rgb2hsb(_rgb_c);

           if (_value < 0.5) {
               return mix(_rgb_a, _rgb_b, 2.0 * _value );
           } else {
               return mix(_rgb_b, _rgb_c, 2.0 * (_value - 0.5));
           }
        }

        void main() {
            vec2 st = gl_FragCoord.xy/u_resolution.xy;

            float prop_min = 0.0;
            float prop_max = 100.0;

            float prop = idw(st);

            vec3 color = prop2color(smoothstep(prop_min, prop_max, prop));

            /*
            vec3 color_low = vec3(84.0 / 255.0, 48.0 / 255.0, 5.0 / 255.0);
            vec3 color_med = vec3(245.0 / 255.0, 245.0 / 255.0, 245.0 / 255.0);
            vec3 color_high = vec3(0.0 / 255.0, 60.0 / 255.0, 48.0 / 255.0);
            */

            color = three_color_gradient(smoothstep(prop_min, prop_max, prop), u_colors[0], u_colors[1], u_colors[2]);



            gl_FragColor=vec4(color,1.0);

        }


</script>
<script src="bundle.js"></script>
<script>
  var container;
  var camera, scene, renderer;
  var uniforms;

  init();
  animate();

  function genPoints(nb_points) {
    var x, y, val, d_min, d_max, rand;
    var points = [];
    for(i = 0; i < nb_points; i++) {
      x = Math.random();
      y = Math.random();
      val = (1.0 - Math.abs(0.5 - x)) * 100.0 -  (1.0 - Math.abs(0.5 - y)) * 20.0;
      d_min = val;
      d_max = 100.0 - val;
      rand = Math.random();
      if (rand < 0.5) {
        rand = 2 * rand;
        val = val - rand * d_min * 0.1;
      } else {
        rand = 2 * (1.0 - rand);
        val = val + rand * d_max * 0.1;
      }

      points.push(new THREE.Vector3(Math.random(), Math.random(), val))
    }

    return points;
  }

  function init () {
    container = document.getElementById('container');

    camera = new THREE.Camera();
    camera.position.z = 1;

    scene = new THREE.Scene();

    var geometry = new THREE.PlaneBufferGeometry(2, 2);
    var time = Date.now();
    console.info('Generating points...');
    var points_array = genPoints(1000);
    console.info('...done in ', Date.now() - time, " ms.");

    uniforms = {
      u_time: {type: 'f', value: 1.0},
      u_resolution: {type: 'v2', value: new THREE.Vector2()},
      u_mouse: {type: 'v2', value: new THREE.Vector2()},
      u_points: {
        type: 'v3v', value: points_array
      },
      u_colors: {
        type: 'v3v', value: [ new THREE.Color(0xf7fcfd), new THREE.Color(0x66c2a4), new THREE.Color(0x00441b)]
      }
    }

    var nb_points = uniforms.u_points.value.length;

    var material = new THREE.ShaderMaterial({
      uniforms: uniforms,
      vertexShader: document.getElementById('vertexShader').textContent,
      fragmentShader: S(document.getElementById('fragmentShader').textContent).template({nb_points: nb_points}).s
    });

    var mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    renderer = new THREE.WebGLRenderer();
    renderer.setPixelRatio(window.devicePixelRatio);

    container.appendChild(renderer.domElement);

    onWindowResize();
    window.addEventListener('resize', onWindowResize, false);

    document.onmousemove = function (e) {
      uniforms.u_mouse.value.x = e.pageX;
      uniforms.u_mouse.value.y = e.pageY;
    }
  }

  function onWindowResize (event) {
    renderer.setSize(window.innerWidth, window.innerHeight);
    uniforms.u_resolution.value.x = renderer.domElement.width;
    uniforms.u_resolution.value.y = renderer.domElement.height;
  }

  function animate () {
    requestAnimationFrame(animate);
    render();
  }

  function render () {
    uniforms.u_time.value += 0.05;
    renderer.render(scene, camera);
  }
</script>
</body>
</html>